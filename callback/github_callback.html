<html>
	<head>
		<title>Octokitty - Github Authentication</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="js/jquery.parsequery.js"></script>
		<script>
			// function check_query(){
			// 	var q = location.hash.toString();

			// 	if( q !== null ){
			// 		var gToken = q.substring(14);
			// 		var result = {};

			// 		if( gToken.length > 0 ){
			// 			result.success = true;
			// 			result.token = gToken;

			// 			console.log('Got token gToken');
			// 		}else{
			// 			result.success = false;
			// 			result.token = "";
			// 			console.log('Failed!');
			// 		}

			// 		window.location.href = "pebblejs://close#" + JSON.stringify(result);
			// 	}
			// }


    	$(document).ready(function() {
    		// should be code only
    		var result = {};
    		var githubCode = location.search;

    		console.log(githubCode);

    		if( githubCode.length > 0 ){
    			githubCode = githubCode.replace("?code=", "");

    			console.log("Formatted code " + githubCode);

    			var postURL = "https://github.com/login/oauth/access_token?client_id=6d2d277b89edf51f76ca&client_secret=67b9cf8da8c46f13edd82284f51aa0e977a6940c&code=<code>";

    			postURL = postURL.replace("<code>", githubCode);

    			// $.post( postURL, function(data){
    			// 	console.log(data);
    			// });

    			$.ajax({
        		url: postURL,
        		type: "POST",
        		cache: false,
        		dataType: "json",
        		crossDomain: true,
        			success : function(response){
        				console.log(response);
        			}
						});
    		}else{
    			result.success = false;
    			result.token = "";
    		}

    		//window.location.href = "pebblejs://close#" + JSON.stringify(result);

    		// post to github to retrieve token ;)
    		//$.post('', function());
      });
    	
		</script>		
	</head>
	<body>
		<div>Connecting to Github...</div>
	</body>
</html>